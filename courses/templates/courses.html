{% extends 'base.html' %}

{% block title %}Course{% endblock %}
{% block menu %}
<div class="flex flex-col flex-1 space-y-4">
    <a href="{% url 'home' %}" class="p-3 rounded-lg hover:bg-purple-100">
        <svg width="32px" height="32px" viewBox="0 -0.5 21 21" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>menu_navigation_grid [#1529]</title> <desc>Created with Sketch.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="Dribbble-Light-Preview" transform="translate(-99.000000, -200.000000)" fill="#000000"> <g id="icons" transform="translate(56.000000, 160.000000)"> <path d="M60.85,51 L57.7,51 C55.96015,51 54.55,52.343 54.55,54 L54.55,57 C54.55,58.657 55.96015,60 57.7,60 L60.85,60 C62.58985,60 64,58.657 64,57 L64,54 C64,52.343 62.58985,51 60.85,51 M49.3,51 L46.15,51 C44.41015,51 43,52.343 43,54 L43,57 C43,58.657 44.41015,60 46.15,60 L49.3,60 C51.03985,60 52.45,58.657 52.45,57 L52.45,54 C52.45,52.343 51.03985,51 49.3,51 M60.85,40 L57.7,40 C55.96015,40 54.55,41.343 54.55,43 L54.55,46 C54.55,47.657 55.96015,49 57.7,49 L60.85,49 C62.58985,49 64,47.657 64,46 L64,43 C64,41.343 62.58985,40 60.85,40 M52.45,43 L52.45,46 C52.45,47.657 51.03985,49 49.3,49 L46.15,49 C44.41015,49 43,47.657 43,46 L43,43 C43,41.343 44.41015,40 46.15,40 L49.3,40 C51.03985,40 52.45,41.343 52.45,43" id="menu_navigation_grid-[#1529]"> </path> </g> </g> </g> </g></svg>
    </a>
    {% if user.role == "teacher"%}
    <a href="{% url 'teacher_student' %}" class="p-3 rounded-lg hover:bg-purple-100">
        <svg height="32px" width="32px" version="1.1" id="_x32_" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 512 512" xml:space="preserve" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <style type="text/css"> .st0{fill:#000000;} </style> <g> <path class="st0" d="M505.837,180.418L279.265,76.124c-7.349-3.385-15.177-5.093-23.265-5.093c-8.088,0-15.914,1.708-23.265,5.093 L6.163,180.418C2.418,182.149,0,185.922,0,190.045s2.418,7.896,6.163,9.627l226.572,104.294c7.349,3.385,15.177,5.101,23.265,5.101 c8.088,0,15.916-1.716,23.267-5.101l178.812-82.306v82.881c-7.096,0.8-12.63,6.84-12.63,14.138c0,6.359,4.208,11.864,10.206,13.618 l-12.092,79.791h55.676l-12.09-79.791c5.996-1.754,10.204-7.259,10.204-13.618c0-7.298-5.534-13.338-12.63-14.138v-95.148 l21.116-9.721c3.744-1.731,6.163-5.504,6.163-9.627S509.582,182.149,505.837,180.418z"></path> <path class="st0" d="M256,346.831c-11.246,0-22.143-2.391-32.386-7.104L112.793,288.71v101.638 c0,22.314,67.426,50.621,143.207,50.621c75.782,0,143.209-28.308,143.209-50.621V288.71l-110.827,51.017 C278.145,344.44,267.25,346.831,256,346.831z"></path> </g> </g></svg>    </a>
    </a>
    {% endif %}
    <a href="{% url 'courses_home' %}" class="p-3 rounded-lg hover:bg-purple-100">
        <svg width="32px" height="32px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M4 19V6.2C4 5.0799 4 4.51984 4.21799 4.09202C4.40973 3.71569 4.71569 3.40973 5.09202 3.21799C5.51984 3 6.0799 3 7.2 3H16.8C17.9201 3 18.4802 3 18.908 3.21799C19.2843 3.40973 19.5903 3.71569 19.782 4.09202C20 4.51984 20 5.0799 20 6.2V17H6C4.89543 17 4 17.8954 4 19ZM4 19C4 20.1046 4.89543 21 6 21H20M9 7H15M9 11H15M19 17V21" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
    </a>
    <a href="{% url 'profile' %}" class="p-3 rounded-lg hover:bg-purple-100">
        <svg width="32px" height="32px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>profile_round [#1342]</title> <desc>Created with Sketch.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="Dribbble-Light-Preview" transform="translate(-140.000000, -2159.000000)" fill="#000000"> <g id="icons" transform="translate(56.000000, 160.000000)"> <path d="M100.562548,2016.99998 L87.4381713,2016.99998 C86.7317804,2016.99998 86.2101535,2016.30298 86.4765813,2015.66198 C87.7127655,2012.69798 90.6169306,2010.99998 93.9998492,2010.99998 C97.3837885,2010.99998 100.287954,2012.69798 101.524138,2015.66198 C101.790566,2016.30298 101.268939,2016.99998 100.562548,2016.99998 M89.9166645,2004.99998 C89.9166645,2002.79398 91.7489936,2000.99998 93.9998492,2000.99998 C96.2517256,2000.99998 98.0830339,2002.79398 98.0830339,2004.99998 C98.0830339,2007.20598 96.2517256,2008.99998 93.9998492,2008.99998 C91.7489936,2008.99998 89.9166645,2007.20598 89.9166645,2004.99998 M103.955674,2016.63598 C103.213556,2013.27698 100.892265,2010.79798 97.837022,2009.67298 C99.4560048,2008.39598 100.400241,2006.33098 100.053171,2004.06998 C99.6509769,2001.44698 97.4235996,1999.34798 94.7348224,1999.04198 C91.0232075,1998.61898 87.8750721,2001.44898 87.8750721,2004.99998 C87.8750721,2006.88998 88.7692896,2008.57398 90.1636971,2009.67298 C87.1074334,2010.79798 84.7871636,2013.27698 84.044024,2016.63598 C83.7745338,2017.85698 84.7789973,2018.99998 86.0539717,2018.99998 L101.945727,2018.99998 C103.221722,2018.99998 104.226185,2017.85698 103.955674,2016.63598" id="profile_round-[#1342]"> </path> </g> </g> </g> </g></svg>
    </a>
</div>
{% endblock %}
{% block content %}
<div class="flex flex-col px-8 py-4 mx-5 bg-white shadow-sm">
    <div class="lg:flex mb-6">
        <p class="text-2xl font-semibold mb-2 lg:mb-0">Courses</p>
    </div>

    <nav class="text-sm font-semibold mb-6" aria-label="Breadcrumb">
        <ol class="list-none p-0 inline-flex">
          <li class="flex items-center text-blue-500">
            <a href="{% url 'home' %}" class="text-gray-700">Home</a>
            <svg class="fill-current w-3 h-3 mx-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg>
          </li>
          <li class="flex items-center">
            <a href="{% url 'courses_home' %}" class="text-gray-600">Courses</a>
          </li>
        </ol>
    </nav>

    {% if user.role == "teacher" %}
    <div class="w-full max-w-4xl h-16 p-4 bg-white shadow-md border-b flex justify-between items-center rounded-md mx-auto">
        <!-- Left Section -->
        <div class="flex items-center space-x-2">
            <span class="text-gray-600 text-lg font-medium">All Course</span>
            <div class="px-2 bg-gray-200 rounded-full">
                <span class="text-gray-700 text-sm">{{ courses.count }}</span>
            </div>
        </div>

        <div class="flex items-center space-x-4">
            <div class="flex space-x-2">
                <button id="create_course" class="px-4 py-1 bg-indigo-600 text-white rounded shadow-sm text-sm font-medium">
                    New Course
                </button>
            </div>
        </div>
    </div>
    {% endif %}
    <div class="grid grid-cols-1 md:grid-cols-1 lg:grid-cols-3 gap-4 mb-20 my-5">
        {% for e in courses %}
            <a href="{% url 'course_detail' e.id %}" class="block">
                <div class="relative flex flex-col bg-white shadow-sm border border-slate-200 rounded-lg">
                    <div class="relative h-48 md:h-56 m-2.5 overflow-hidden text-white rounded-md">
                        <img src="{{ e.image.url }}" alt="card-image" class="w-full h-full object-cover"/>
                    </div>
                    <div class="p-4">
                        <h6 class="mb-2 text-slate-800 text-lg md:text-xl font-semibold">
                            {{e.course_code}} {{e.course_name}}
                        </h6>
                        <p class="text-slate-600 leading-normal font-light text-sm md:text-base">
                            {{ e.details|slice:":50" }}{% if e.details|length > 50 %}...{% endif %}
                        </p>
                    </div>
                
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 space-y-3 sm:space-y-0">
                        <div class="flex items-center">
                            <img
                                alt="Teacher Profile"
                                src="{{ e.teacher.profile_path.url }}"
                                class="h-8 w-8 rounded-full object-cover"
                            />
                            <div class="flex flex-col ml-3 text-sm">
                                <span class="text-slate-800 font-semibold">{{e.teacher}}</span>
                                <span class="text-slate-600">{{e.create_at}}</span>
                            </div>
                        </div>
                        <button class="w-full sm:w-auto px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            ดูรายละเอียด
                        </button>
                    </div>
                </div> 
            </a>
        {% endfor %}
    </div>
</div>
<div id="course_modal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center z-50">
    <div class="bg-white p-8 rounded-lg w-full max-w-2xl max-h-[80vh] overflow-y-auto">
        <h2 class="text-xl font-bold mb-4">Create New Course</h2>
        <form id="course_form" method="POST" action="{% url 'create_course' %}" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="grid gap-4">
                <!-- Course Code -->
                <div>
                    <label class="block text-sm font-medium">Course Code</label>
                    <input type="text" name="course_code" required
                        class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500">
                </div>

                <!-- Course Name -->
                <div>
                    <label class="block text-sm font-medium">Course Name</label>
                    <input type="text" name="course_name" required
                        class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500">
                </div>

                <!-- Details -->
                <div>
                    <label class="block text-sm font-medium">Details</label>
                    <textarea name="details" rows="3" required
                        class="w-full px-4 py-2 border rounded-md focus:ring-indigo-500"></textarea>
                </div>

                <!-- Image -->
                <div>
                    <label class="block text-sm font-medium">Image</label>
                    <input type="file" name="image" accept="image/*"
                        class="w-full px-4 py-2 border rounded-md">
                </div>

                <!-- Schedule -->
                <div>
                    <label class="block text-sm font-medium">Schedule</label>
                    <div class="grid grid-cols-2 gap-2">
                        <!-- Start Time -->
                        <div>
                            <label class="text-sm">Start Time</label>
                            <input type="time" name="start_time" required
                                class="w-full px-4 py-2 border rounded-md">
                        </div>

                        <!-- End Time -->
                        <div>
                            <label class="text-sm">End Time</label>
                            <input type="time" name="end_time" required
                                class="w-full px-4 py-2 border rounded-md">
                        </div>

                        <!-- Room -->
                        <div>
                            <label class="text-sm">Room</label>
                            <select name="room" required
                                class="w-full px-4 py-2 border rounded-md">
                                <option value="">Select Room</option>
                                {% for room in rooms %}
                                    <option value="{{ room.id }}">{{ room.building }} - {{ room.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Day of Week -->
                        <div>
                            <label class="block text-sm font-medium">Day of Week</label>
                            <div class="space-y-2">
                                {% for day in days_of_week %}
                                    <label class="flex items-center space-x-2">
                                        <input type="checkbox" name="day_of_week" value="{{ day|lower }}"
                                            class="h-5 w-5 text-indigo-600 border-gray-300 rounded">
                                        <span>{{ day }}</span>
                                    </label>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Submit & Cancel -->
            <div class="flex justify-end space-x-4 mt-6">
                <button type="button" id="cancel_modal"
                    class="px-4 py-2 bg-gray-300 text-black rounded-md">
                    Cancel
                </button>
                <button type="submit"
                    class="px-4 py-2 bg-indigo-600 text-white rounded-md">
                    Save Course
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
{% block script %}
document.getElementById('create_course').addEventListener('click', () => {
    document.getElementById('course_modal').classList.remove('hidden');
});

document.getElementById('cancel_modal').addEventListener('click', () => {
    document.getElementById('course_modal').classList.add('hidden');
});
{% endblock %}